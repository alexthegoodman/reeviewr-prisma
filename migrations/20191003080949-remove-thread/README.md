# Migration `20191003080949-remove-thread`

This migration has been generated by Alex Woodman at 10/3/2019, 8:09:49 AM.
You can check out the [state of the datamodel](./datamodel.prisma) after the migration.

## Database Steps

```sql
ALTER TABLE "public"."ThreadMeta" DROP COLUMN "thread",ADD COLUMN "thread" text   REFERENCES "public"."Thread"("id") ON DELETE SET NULL;

ALTER TABLE "public"."ReviewMeta" DROP COLUMN "review",ADD COLUMN "review" text   REFERENCES "public"."Review"("id") ON DELETE SET NULL;

ALTER TABLE "public"."AnnotationMeta" DROP COLUMN "annotation",ADD COLUMN "annotation" text   REFERENCES "public"."Annotation"("id") ON DELETE SET NULL;

ALTER TABLE "public"."QuestionMeta" DROP COLUMN "question",ADD COLUMN "question" text   REFERENCES "public"."Question"("id") ON DELETE SET NULL;

ALTER TABLE "public"."Thread" DROP COLUMN "user",ADD COLUMN "user" text   REFERENCES "public"."User"("id") ON DELETE SET NULL;

ALTER TABLE "public"."Message" DROP COLUMN "user",ADD COLUMN "user" text   REFERENCES "public"."User"("id") ON DELETE SET NULL,DROP COLUMN "thread",ADD COLUMN "thread" text   REFERENCES "public"."Thread"("id") ON DELETE SET NULL;

ALTER TABLE "public"."Question" DROP COLUMN "user",ADD COLUMN "user" text   REFERENCES "public"."User"("id") ON DELETE SET NULL,DROP COLUMN "post",ADD COLUMN "post" text   REFERENCES "public"."Post"("id") ON DELETE SET NULL;

ALTER TABLE "public"."NotificationMeta" DROP COLUMN "notification",ADD COLUMN "notification" text   REFERENCES "public"."Notification"("id") ON DELETE SET NULL;

ALTER TABLE "public"."PodMeta" DROP COLUMN "pod",ADD COLUMN "pod" text   REFERENCES "public"."Pod"("id") ON DELETE SET NULL;

ALTER TABLE "public"."Pod" DROP COLUMN "user",ADD COLUMN "user" text   REFERENCES "public"."User"("id") ON DELETE SET NULL;

ALTER TABLE "public"."UserMeta" DROP COLUMN "user",ADD COLUMN "user" text   REFERENCES "public"."User"("id") ON DELETE SET NULL;

ALTER TABLE "public"."MessageMeta" DROP COLUMN "message",ADD COLUMN "message" text   REFERENCES "public"."Message"("id") ON DELETE SET NULL;

ALTER TABLE "public"."Review" DROP COLUMN "user",ADD COLUMN "user" text   REFERENCES "public"."User"("id") ON DELETE SET NULL,DROP COLUMN "post",ADD COLUMN "post" text   REFERENCES "public"."Post"("id") ON DELETE SET NULL;

ALTER TABLE "public"."Annotation" DROP COLUMN "user",ADD COLUMN "user" text   REFERENCES "public"."User"("id") ON DELETE SET NULL,DROP COLUMN "post",ADD COLUMN "post" text   REFERENCES "public"."Post"("id") ON DELETE SET NULL;

ALTER TABLE "public"."_FollowRelation" DROP COLUMN "A",ADD COLUMN "A" text   REFERENCES "public"."User"("id") ON DELETE CASCADE,DROP COLUMN "B",ADD COLUMN "B" text   REFERENCES "public"."User"("id") ON DELETE CASCADE;

ALTER TABLE "public"."_JoinPodRelation" DROP COLUMN "A",ADD COLUMN "A" text   REFERENCES "public"."Pod"("id") ON DELETE CASCADE,DROP COLUMN "B",ADD COLUMN "B" text   REFERENCES "public"."User"("id") ON DELETE CASCADE;

ALTER TABLE "public"."Favorite" DROP COLUMN "user",ADD COLUMN "user" text   REFERENCES "public"."User"("id") ON DELETE SET NULL,DROP COLUMN "post",ADD COLUMN "post" text   REFERENCES "public"."Post"("id") ON DELETE SET NULL;

ALTER TABLE "public"."_CategoryToPod" DROP COLUMN "A",ADD COLUMN "A" text   REFERENCES "public"."Category"("id") ON DELETE CASCADE,DROP COLUMN "B",ADD COLUMN "B" text   REFERENCES "public"."Pod"("id") ON DELETE CASCADE;

ALTER TABLE "public"."_PostToTag" DROP COLUMN "A",ADD COLUMN "A" text   REFERENCES "public"."Post"("id") ON DELETE CASCADE,DROP COLUMN "B",ADD COLUMN "B" text   REFERENCES "public"."Tag"("id") ON DELETE CASCADE;

ALTER TABLE "public"."Notification" DROP COLUMN "thread",DROP COLUMN "user",ADD COLUMN "user" text   REFERENCES "public"."User"("id") ON DELETE SET NULL;

ALTER TABLE "public"."PostMeta" DROP COLUMN "post",ADD COLUMN "post" text   REFERENCES "public"."Post"("id") ON DELETE SET NULL;

ALTER TABLE "public"."Post" DROP COLUMN "user",ADD COLUMN "user" text   REFERENCES "public"."User"("id") ON DELETE SET NULL,DROP COLUMN "pod",ADD COLUMN "pod" text   REFERENCES "public"."Pod"("id") ON DELETE SET NULL;
```

## Changes

```diff
diff --git datamodel.mdl datamodel.mdl
migration 20190831111031-member-of-and-members..20191003080949-remove-thread
--- datamodel.dml
+++ datamodel.dml
@@ -249,9 +249,8 @@
   itemName    String
   itemContent String
   itemDeleted Boolean            @default(false)
   itemMeta    NotificationMeta[]
-  thread      Thread
   createdAt   DateTime           @default(now())
   updatedAt   DateTime           @updatedAt
 }
```

## Photon Usage

You can use a specific Photon built for this migration (20191003080949-remove-thread)
in your `before` or `after` migration script like this:

```ts
import Photon from '@generated/photon/20191003080949-remove-thread'

const photon = new Photon()

async function main() {
  const result = await photon.users()
  console.dir(result, { depth: null })
}

main()

```
